- name: vcst-qa
  gitops: true
  production: false
  servicePlan: B1
  platform:
    imageRepository: virtopaasregistrymain.azurecr.io/vcst/platform
    sqlReplica: false
    config:
      APPINSIGHTS_INSTRUMENTATIONKEY: ef0125aa-1c8e-42d3-964f-d0a11256309d
      ASPNETCORE_FORWARDEDHEADERS_ENABLED: true
      AzureAd__ApplicationId: 8227d950-975c-4c28-b7d4-ea440a59dcbb
      AzureAd__Enabled: true
      AzureAd__TenantId: bc03e660-5e3a-45c4-bf5c-b75489f78923
      Content__FileSystem__RootPath: /opt/virtocommerce/platform/wwwroot/cms-content
      Content__PathMappings__pages__0: Themes
      Content__PathMappings__pages__1: _storeId
      Content__PathMappings__pages__2: _theme
      Content__PathMappings__pages__3: content/pages
      Content__PathMappings__themes__0: Themes
      Content__PathMappings__themes__1: _storeId
      DOTNET_USE_POLLING_FILE_WATCHER: true
      Notifications__DefaultSender: azure_25da07ed75daacae20578a7a7dc58541@azure.com
      Notifications__Gateway: SendGrid
      Notifications__SmsDefaultSender: +17012510519
      Payments__AuthorizeNet__ApiLogin: 8hPT4p99R
      Search__ContentFullTextSearchEnabled: true
      Search__ElasticAppSearch__Endpoint: https://enterprise-search-test.govirto.com
      Search__ElasticAppSearch__EnableHttpCompression: true
      Search__ElasticSearch__Server: https://elasticsearch-vc03.govirto.com
      Search__ElasticSearch__EnableCompatibilityMode: true
      Search__OrderFullTextSearchEnabled: true
      Search__Provider: ElasticSearch
      VirtoCommerce__LocalUploadFolderPath: wwwroot/cms-content
      VirtoCommerce__SampleDataUrl: https://vc3prerelease.blob.core.windows.net/packages/clothing-and-electronics_3_0_2.zip
      IdentityOptions__Lockout__AutoAccountsLockoutJobEnabled: false
      IdentityOptions__Lockout__LockoutMaximumDaysFromLastLogin: 3
      IdentityOptions__Lockout__CronAutoAccountsLockoutJob: 0/5 * * * *
      IdentityOptions__User__RemindPasswordExpiryInDays: 7
      IdentityOptions__User__MaxPasswordAge: 90
      IdentityOptions__Lockout__MaxFailedAccessAttempts: 5
      FrontendSecurity__OrganizationMaintainerRole: "Organization maintainer"
    secretConfig:
      Notifications__SendGrid__ApiKey: sendgrid-apikey
      Payments__AuthorizeNet__SHA2Hash: authorizenet-sha2hash
      Payments__AuthorizeNet__TxnKey: authorizenet-txnkey
  storefront:
    enabled: true
    imageRepository: virtopaasregistrymain.azurecr.io/vcst/storefront
    servicePlan: B1
    probePath: /storefrontapi/health
    config:
      APPINSIGHTS_INSTRUMENTATIONKEY: 48cca1d8-ea02-433e-bfa6-7aa21acb88d9
      CookieAuthenticationOptions__LoginPath: /sign-in
      DOTNET_USE_POLLING_FILE_WATCHER: true
      SnapshotCollectorConfiguration__IsEnabled: false
      SYSTEM_RESTART: 25.10.2023
      VirtoCommerce__Endpoint__Password: Store12345
      VirtoCommerce__CacheSlidingExpiration: 0:0:5
  ingress:
    config: >-
      set \$\prerender 0;

      if (\$\http_user_agent ~* "googlebot|yahoo!\ slurp|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|developers.google.com\/\+\/web\/snippet|slackbot|vkShare|W3C_Validator|redditbot|applebot|whatsapp|flipboard|tumblr|bitlybot|skypeuripreview|nuzzel|discordbot|google\ page\ speed|qwantify|pinterestbot|bitrix\ link\ preview|xing-contenttabreceiver|chrome-lighthouse|telegrambot|google-inspectiontool|petalbot")
        {
          set \$\prerender 1;
        }

      if (\$\http_user_agent ~* "Prerender")
        {
          set \$\prerender 0;
        }

      if (\$\args ~ "_escaped_fragment_")
        {
          set \$\prerender 1;
        }

      if (\$\http_x_prerender = "1")
        {
          set \$\prerender 0;
        }

      if (\$\uri ~* "\.(js|css|xml|less|png|jpg|jpeg|gif|pdf|txt|ico|rss|zip|mp3|rar|exe|wmv|doc|avi|ppt|mpg|mpeg|tif|wav|mov|psd|ai|xls|mp4|m4a|swf|dat|dmg|iso|flv|m4v|torrent|ttf|woff|woff2|svg|eot)")
        {
          set \$\prerender 0;
        }

      location /
        {
          if (\$\prerender = 1)
            {
              rewrite (.*) /prerenderio last;
            }
        }

      location /prerenderio
        {
          if (\$\prerender = 0)
            {
              return 404;
            }

          proxy_hide_header Cache-Control;
          add_header Cache-Control "private,max-age=600,must-revalidate";

          resolver 8.8.8.8 8.8.4.4;
          set \$\prerender_host "service.prerender.io";
          proxy_pass https://\$\prerender_host;
          rewrite .* /\$\scheme://\$\host\$\request_uri? break;
        }
  customApps:
    app1:
      name: storybook
      enabled: true
      imageRepository: ghcr.io/virtocommerce/vc-theme-b2b-vue-storybook
      servicePlan: F1
      type: standalone
      hostname: vcst-qa-storybook.paas.govirto.com
      probePath: /
      ingressPath: /
    app2:
      enabled: false
  protectedParameters:
   - platform.image.tag
   - storefront.image.tag
   - themes.B2B-store
   - custom.app1.image.tag
  version: 3.211
